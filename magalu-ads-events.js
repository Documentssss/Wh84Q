!function(){"use strict";var e;!function(e){e.VIEW="ads-view-event",e.CLICK="ads-click-event",e.IMPRESSION="ads-impression-event",e.DISABLE_EVENT="ads-disable-event",e.DISABLE_PREVENT="ads-disable-prevent"}(e||(e={}));var t=new class{observe(e,t){e.addEventListener("mousedown",t)}observeClick(e,t){e.addEventListener("click",t)}getTargets(t){return t.hasAttribute(e.CLICK)?[t]:Array.from(t.querySelectorAll(`[${e.CLICK}]`)||[])}};class n{constructor(){this.timeout=1e3}start(e){this.timerId=setTimeout((()=>{e(),this.timerId=null}),this.timeout)}stop(){clearTimeout(this.timerId),this.timerId=null}}class r{constructor(){this.timer=new n,this.ADS_VIEW_PERCENT=.5}observe(e,t){const n=new IntersectionObserver((e=>{e.forEach((e=>{return n=this,r=void 0,s=function*(){e.isIntersecting?this.timer.start((()=>t(e))):this.timer.stop()},new((o=void 0)||(o=Promise))((function(e,t){function i(e){try{c(s.next(e))}catch(e){t(e)}}function a(e){try{c(s.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(i,a)}c((s=s.apply(n,r||[])).next())}));var n,r,o,s}))}),{root:null,threshold:this.ADS_VIEW_PERCENT});return n.observe(e),n}getTargets(t){return t.hasAttribute(e.VIEW)?[t]:Array.from(t.querySelectorAll(`[${e.VIEW}]`)||[])}}var o,s,i,a=new r,c=new class{constructor(){this.observers=[]}notify(e){this.observers.forEach((t=>{try{t(e)}catch(e){console.error("MagaluAds::ImpressionObserver",e)}}))}subscribe(e){this.observers.push(e)}},d=new class{constructor(){this.observers=[]}notify(e){this.observers.forEach((t=>{try{t(e)}catch(e){console.error("MagaluAds::ErrorObserver",e)}}))}subscribe(e){this.observers.push(e)}};!function(e){e.INIT="INIT",e.GET_ADS="GET_ADS",e.GET_CONFIG="GET_CONFIG",e.EVENTS="EVENTS",e.FILLRATE="FILLRATE",e.RENDER="RENDER"}(o||(o={})),function(e){e.TARGET_NOT_FOUND="target.not.found",e.ERROR_ON_REQUEST="error.on.request"}(s||(s={})),function(e){e.NONE="NONE",e.API="API",e.CONSOLE="CONSOLE"}(i||(i={}));const u=(e,t={})=>{return n=void 0,r=void 0,i=function*(){const n=Object.assign({},t);t.body&&(n.body=JSON.stringify(t.body));const r=yield fetch(e,n);if(r.status<200||r.status>299)throw{message:s.ERROR_ON_REQUEST,response:r};return r},new((o=void 0)||(o=Promise))((function(e,t){function s(e){try{c(i.next(e))}catch(e){t(e)}}function a(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof o?n:new o((function(e){e(n)}))).then(s,a)}c((i=i.apply(n,r||[])).next())}));var n,r,o,i};var l,v;!function(e){e.SDK="magalu.ads.ready",e.SDK_COLLECTOR="magalu.ads.collector.ready",e.SDK_EVENTS="magalu.ads.events.ready"}(l||(l={})),function(e){e.VIEW="VIEW",e.IMPRESSION="IMPRESSION",e.CLICK="CLICK"}(v||(v={}));const h=(e,t=!0)=>{try{const n=null==e?void 0:e.match(/(\d{5})-?(\d{3})/i);return n&&n.length>2?t?`${n[1]}-${n[2]}`:`${n[1]}${n[2]}`:""}catch(e){return""}};var g=function(e,t,n,r){return new(n||(n=Promise))((function(o,s){function i(e){try{c(r.next(e))}catch(e){s(e)}}function a(e){try{c(r.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,a)}c((r=r.apply(e,t||[])).next())}))};const E=e=>g(void 0,void 0,void 0,(function*(){var t,n,r,o,s,i,a;const c={sdkType:"WEB",publisherId:(null===(t=e.sdkContext)||void 0===t?void 0:t.publisherId)||"not_present"};var d;return c.placement=(null===(n=e.sdkContext)||void 0===n?void 0:n.placement)||(null===(r=e.placement)||void 0===r?void 0:r.name)||void 0,c.page=(null===(o=e.sdkContext)||void 0===o?void 0:o.page)||void 0,c.channel=null===(s=e.sdkContext)||void 0===s?void 0:s.channel,c.pageUri=(null===(i=e.sdkContext)||void 0===i?void 0:i.pageUri)||void 0,c.searchTerm=(null===(a=e.sdkContext)||void 0===a?void 0:a.searchTerm)||void 0,c.user=(e=>{var t,n,r,o;const s={};return s.id=(null===(t=e.sdkContext)||void 0===t?void 0:t.userId)||void 0,s.navigationId=(null===(n=e.sdkContext)||void 0===n?void 0:n.navigationId)||(null===(r=e.sdkContext)||void 0===r?void 0:r.userTrackId)||void 0,s.zipcode=(null===(o=e.sdkContext)||void 0===o?void 0:o.zipcode)||void 0,s})(e),c.ads=(d=e.ad,e.ads||(d?[d]:[])),c.errorDetail=yield(e=>g(void 0,void 0,void 0,(function*(){const t={originAction:e.originAction};return t.stackTrace=yield(e=>g(void 0,void 0,void 0,(function*(){var t;const n=yield(e=>g(void 0,void 0,void 0,(function*(){var t;const n={};try{e&&(n.message=e.message||"not_present",n.name=e.name||"not_present",n.stack=e.stack||"not_present",(null===(t=e.response)||void 0===t?void 0:t.json)&&(n.json=yield e.response.json()))}catch(e){n.exception="Something went wrong while normalize error"}return n})))(e.error),r={sdkVersion:"2.16.1",href:(null===(t=window.location)||void 0===t?void 0:t.href)?window.location.href:"not_present",details:e.details,userAgent:(null===navigator||void 0===navigator?void 0:navigator.userAgent)?navigator.userAgent:"not_present",error:n,sdkContext:e.sdkContext};return JSON.stringify(r)})))(e),t.errorMessage=e.errorMessage,t})))(e),c})),I=e=>g(void 0,void 0,void 0,(function*(){try{const t=yield E(e);switch("API"){case i.API:(e=>{g(void 0,void 0,void 0,(function*(){const t={method:"POST",body:e,headers:{"Content-type":"application/json"}};yield u("https://ads-collector.luizalabs.com/api/v1/errors",t)}))})(t);break;case i.CONSOLE:console.error(t)}}catch(e){console.error(e)}}));var f;!function(e){e.CLICK="/api/v1/metric/click",e.IMPRESSION="/api/v1/metric/impression",e.VIEW="/api/v1/metric/view"}(f||(f={}));const p=(e,t,n,r)=>{return s=void 0,i=void 0,c=function*(){try{const o=(e=>{switch(e){case v.CLICK:return f.CLICK;case v.IMPRESSION:return f.IMPRESSION;case v.VIEW:return f.VIEW;default:return"/"}})(n),s=`https://ads-collector.luizalabs.com${o}`,i=((e,t,n,r)=>{const o={adId:n.adId,campaignId:n.campaignId,sku:n.sku,sellerId:n.sellerId,category:n.category,subCategory:n.subCategory,brand:n.brand,gender:n.gender||""};let s={adRequestId:n.adRequestId,adResponseId:n.adResponseId,adType:null==n?void 0:n.type,publisherId:null==n?void 0:n.publisherId,channel:t.channel,page:t.page,placement:t.placement||r.name,user:{id:t.userId,navigationId:t.navigationId||t.userTrackId||t.userId,zipcode:h(t.zipcode)}};return e===v.CLICK?s=Object.assign(Object.assign({},s),o):s.ads=[o],s})(n,e,t,r),a={method:"POST",body:i,headers:{"Content-type":"application/json"}};yield u(s,a)}catch(s){I({errorMessage:"sendEvent",originAction:n||o.EVENTS,placement:r,ad:t,sdkContext:e,error:s}),d.notify({error:s})}},new((a=void 0)||(a=Promise))((function(e,t){function n(e){try{o(c.next(e))}catch(e){t(e)}}function r(e){try{o(c.throw(e))}catch(e){t(e)}}function o(t){var o;t.done?e(t.value):(o=t.value,o instanceof a?o:new a((function(e){e(o)}))).then(n,r)}o((c=c.apply(s,i||[])).next())}));var s,i,a,c};var b,A,m,y,C,R,S=new class{execute(e,t,n,r){return o=this,s=void 0,a=function*(){c.notify({ad:n,target:t}),p(e,n,v.IMPRESSION,r)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function r(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,r)}c((a=a.apply(o,s||[])).next())}));var o,s,i,a}getTargets(t){return t.getAttribute(e.IMPRESSION)?[t]:Array.from(t.querySelectorAll(`[${e.IMPRESSION}]`))}getAdFromAttributeId(t,n){const r=t.getAttribute(e.IMPRESSION);return n.find((e=>{var t;return(null===(t=e.adId)||void 0===t?void 0:t.toString())==r}))}getAdFromDataAttribute(t){const n=t.getAttribute(e.IMPRESSION);return JSON.parse(n||"")}},O=new class{constructor(){this.observers=[]}notify(e){this.observers.forEach((t=>{try{t(e)}catch(e){console.error("MagaluAds::ClickObserver",e)}}))}subscribe(e){this.observers.push(e)}},T=new class{execute(e,t,n,r){return o=this,s=void 0,a=function*(){O.notify({ad:n,placement:r,target:t.currentTarget,clickElementTarget:t.target,event:t}),p(e,n,v.CLICK,r)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function r(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,r)}c((a=a.apply(o,s||[])).next())}));var o,s,i,a}getAdFromAttributeId(t,n){const r=t.getAttribute(e.CLICK);return n.find((e=>{var t;return(null===(t=e.adId)||void 0===t?void 0:t.toString())==r}))}getAdFromDataAttribute(t){const n=t.getAttribute(e.CLICK);return JSON.parse(n||"")}},w=new class{constructor(){this.observers=[]}notify(e){this.observers.forEach((t=>{try{t(e)}catch(e){console.error("MagaluAds::ViewObserver",e)}}))}subscribe(e){this.observers.push(e)}},N=new class{execute(e,t,n,r){return o=this,s=void 0,a=function*(){w.notify({ad:n,placement:r,target:t}),p(e,n,v.VIEW,r)},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function r(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var o;t.done?e(t.value):(o=t.value,o instanceof i?o:new i((function(e){e(o)}))).then(n,r)}c((a=a.apply(o,s||[])).next())}));var o,s,i,a}getAdFromAttributeId(t,n){const r=t.getAttribute(e.VIEW);return n.find((e=>{var t;return(null===(t=e.adId)||void 0===t?void 0:t.toString())==r}))}getAdFromDataAttribute(t){const n=t.getAttribute(e.VIEW);return JSON.parse(n||"")}};!function(e){e.SPONSORED_PRODUCT="SPONSORED_PRODUCT",e.SPONSORED_BANNER="SPONSORED_BANNER"}(b||(b={})),function(e){e.BEFORE_BEGIN="beforebegin",e.AFTER_BEGIN="afterbegin",e.BEFORE_END="beforeend",e.AFTER_END="afterend"}(A||(A={})),function(e){e.MUSTACHE="mustache",e.HANDLEBARS="handlebars"}(m||(m={})),function(e){e.MSITE="MSITE",e.WEB="WEB",e.APP_IOS="APP_IOS",e.APP_ANDROID="APP_ANDROID"}(y||(y={})),function(e){e.HOME="HOME",e.CART="CART",e.SEARCH="SEARCH",e.CATEGORY="CATEGORY",e.SHOWCASE="SHOWCASE"}(C||(C={})),function(e){e.HOME="HOME",e.CART="CART",e.SEARCH="SEARCH",e.CATEGORY="CATEGORY"}(R||(R={}));const P=e=>e.map((e=>({category:e.category,subCategory:e.subCategory,brand:e.brand,gender:e.gender,adId:e.adId,campaignId:e.campaignId,sku:e.sku,sellerId:e.sellerId,productName:e.name}))),x=(e,t,n)=>{return r=void 0,s=void 0,a=function*(){try{const r=((e,t)=>{const n=Object.assign({},e);return t.page===C.SHOWCASE&&(n.referenceProduct={sku:t.sku,name:t.name,sellerId:t.seller,category:t.category,subCategory:t.subCategory,brand:t.brand,gender:t.genders[0]||""}),t.searchTerm?n.searchTerm=t.searchTerm:t.pageUri&&(n.pageUri=t.pageUri),n})({adRequestId:n.adRequestId,adResponseId:n.adResponseId,adType:n.adType,adsRequestedCount:n.adsRequestedCount,adsReturnedCount:n.adsReturnedCount,publisherId:e.publisherId,channel:e.channel,page:e.page,ads:P(t),zipCode:h(e.zipcode,!1),adsMatchReason:n.matchReason},e),o="https://ads-collector.luizalabs.com/api/v1/fillrate",s={method:"POST",body:r,headers:{"Content-type":"application/json"}};yield u(o,s)}catch(r){I({errorMessage:"sendFillrateEvent",originAction:o.FILLRATE,sdkContext:e,ads:t,details:{adsProps:n},error:r}),d.notify({error:r})}},new((i=void 0)||(i=Promise))((function(e,t){function n(e){try{c(a.next(e))}catch(e){t(e)}}function o(e){try{c(a.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof i?r:new i((function(e){e(r)}))).then(n,o)}c((a=a.apply(r,s||[])).next())}));var r,s,i,a};var _;!function(e){e.LOCAL="local",e.HMG="hmg",e.PRD="prd",e.TEST="test"}(_||(_={}));const D=new class{execute(e,t,n){return r=this,o=void 0,i=function*(){this.sendFillrate(e,n,t),t&&(this.sendImpressionEvents(e,t,n),this.initViewObservers(e,t,n),this.initClickObservers(e,t,n))},new((s=void 0)||(s=Promise))((function(e,t){function n(e){try{c(i.next(e))}catch(e){t(e)}}function a(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var r;t.done?e(t.value):(r=t.value,r instanceof s?r:new s((function(e){e(r)}))).then(n,a)}c((i=i.apply(r,o||[])).next())}));var r,o,s,i}getAdsFromImpressionAttribute(e){const t=S.getTargets(e),n=[];return 0==t.length||t.forEach(((e,t)=>{const r=S.getAdFromDataAttribute(e);r&&n.push(r)})),n}sendFillrate(e,t,n){const r=e.matchReason||"",o=e.adsRequestedCount||0,s=e.adsReturnedCount||0;let i,a=[],c=e.adRequestId,d=e.adResponseId;t.length>0?a=t:n&&(a=this.getAdsFromImpressionAttribute(n)),a.length>0&&(c=a[0].adRequestId||c,d=a[0].adResponseId||d,i=a[0].type||i),x(e,a,{adRequestId:c,adResponseId:d,adType:i,matchReason:r,adsRequestedCount:o,adsReturnedCount:s})}sendImpressionEvents(e,t,n){const r=S.getTargets(t);r.length>0&&r.forEach((t=>{let r;r=n.length>0?S.getAdFromAttributeId(t,n):S.getAdFromDataAttribute(t),S.execute(e,t,r,{})}))}initViewObservers(e,t,n){a.getTargets(t).forEach((t=>{const o=(new r).observe(t,(t=>{let r;r=n.length>0?N.getAdFromAttributeId(t.target,n):N.getAdFromDataAttribute(t.target),N.execute(e,t.target,r,{}),o.unobserve(t.target)}))}))}initClickObservers(n,r,o){const s=t.getTargets(r),i=t=>{const r=void 0!==t.buttons&&t.buttons<2;if(!t.target.hasAttribute(e.DISABLE_EVENT)){const s=t.currentTarget.hasAttribute(e.DISABLE_PREVENT);let i;if(i=o.length>0?T.getAdFromAttributeId(t.currentTarget,o):T.getAdFromDataAttribute(t.currentTarget),T.execute(n,t,i,{}),!s&&r){const e=t.currentTarget.getAttribute("redirect");e&&setTimeout((()=>{window.location.href=e}),800)}}},a=t=>{const n=t.target.hasAttribute(e.DISABLE_PREVENT),r=t.target.hasAttribute(e.DISABLE_EVENT);n||r||t.preventDefault()};s.forEach((e=>{t.observeClick(e,a),t.observe(e,i)}))}};window.magaluAdsEvents=new class{init(e,t){return n=this,r=void 0,i=function*(){try{D.execute(e,e.target,t||[])}catch(t){I({errorMessage:"MagaluAdsEvents:init",originAction:o.INIT,sdkContext:e,error:t}),d.notify({error:t})}},new((s=void 0)||(s=Promise))((function(e,t){function o(e){try{c(i.next(e))}catch(e){t(e)}}function a(e){try{c(i.throw(e))}catch(e){t(e)}}function c(t){var n;t.done?e(t.value):(n=t.value,n instanceof s?n:new s((function(e){e(n)}))).then(o,a)}c((i=i.apply(n,r||[])).next())}));var n,r,s,i}onError(e){d.subscribe(e)}onAdView(e){w.subscribe(e)}onAdClick(e){O.subscribe(e)}},window.document.dispatchEvent(new CustomEvent(l.SDK_EVENTS))}();